alias sleepon='sudo pmset -a disablesleep 0'
alias sleepoff='sudo pmset -a disablesleep 1'

# 各種GNU系コマンドを優先して使うようにする
export PATH="/opt/homebrew/opt/grep/libexec/gnubin:$PATH"
export PATH="/opt/homebrew/opt/gnu-sed/libexec/gnubin:$PATH"
export PATH="/opt/homebrew/opt/gnu-tar/libexec/gnubin:$PATH"
alias date='gdate'

# 1password CLIとGitHub CLIを連携
# source ~/.config/op/plugins.sh

function preset_git_sign_passphrase () {
    # GPGエージェントに既にキャッシュがあるかチェック（テスト署名で確認）
    if echo "test" | gpg --sign --local-user 348816E54CEE73E7 &> /dev/null; then
        return 0
    fi

    gpg-connect-agent /bye &> /dev/null

    # 1Password CLIがログインに失敗した場合、無限に待たされないようにする
    local signin_output
    signin_output=$(timeout 5 op signin 2>/dev/null)
    if [[ $? -ne 0 ]]; then
        echo "op signin failed or timed out" >&2
        return 1
    fi
    eval "$signin_output"
    env GPG_PASSPHRASE="op://Personal/Git GPG Passphrases/password" op run --no-masking -- printenv GPG_PASSPHRASE | /opt/homebrew/opt/gnupg/libexec/gpg-preset-passphrase --preset 37FFCC7E610959633E1CAAF801C0718493B98CDF
}

preset_git_sign_passphrase
